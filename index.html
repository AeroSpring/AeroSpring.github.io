<body> 
  <canvas></canvas>
  <style>
    body, canvas {
      margin: 0;
      width: 100vw;
      height: 100vh;
    }
  </style>

  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.js"></script>
  <script>
    // Извлечение тега canvas
    let canvas = window.document.querySelector('canvas');
    // Создание движка
    let engine = new BABYLON.Engine(canvas);
    // Создание сцены и присоеденение ее к движку
    let scene = new BABYLON.Scene(engine);
    // Создание среды по умолчанию (для вывода текстур 3D-модели)
    scene.createDefaultEnvironment({
      createSkybox: false,
      createGround: false
    });
    // Создание света
    let light = new BABYLON.PointLight('light', new BABYLON.Vector3(10, 10, -2), scene);
    light.intensity = 0.7;

    // Подключение WebXR
    scene.createDefaultXRExperienceAsync({
      uiOptions: {
        sessionMode: 'immersive-ar', 
        referenceSpaceType: 'local-floor',
      }
    });



    // ПЕРЕМЕННЫЕ
    let activeElement = null;



    /*
    // Создание куба
    let box = new BABYLON.Mesh.CreateBox('box', 0.1, scene);
    box.material = new BABYLON.StandardMaterial('material', scene);
    box.material.emissiveColor = new BABYLON.Color3(0, 0.58, 0.86);
    // Позиционирование
    box.position.y = 1;
    box.position.z = 1;
    // Степень непрозрачности
    box.hasVertexAlpha = true;
    box.visibility = 0.7;
    */

    //ЗАГРУЗКА 3D-МОДЕЛИ
    BABYLON.SceneLoader.ImportMesh(
      null, 
      'assets/drone/', 
      'drone.glb', 
      scene, 
      (meshArray) => {
        let drone = meshArray[0];
        drone.scaling = new BABYLON.Vector3(0.5, 0.5, 0.5);
        drone.position = new BABYLON.Vector3(-1, 1, 4);
        shadowGenerator.addShadowCaster(drone); //отбрасываемая тень
        drone.receiveShadows = true; //принимаемая тень
      }
    );

    BABYLON.SceneLoader.ImportMesh(
      null, 
      'assets/steampunk/', 
      'steampunk.glb', 
      scene, 
      (meshArray) => {
        let steampunk = meshArray[0];
        steampunk.scaling = new BABYLON.Vector3(0.15, 0.15, 0.15);
        steampunk.position = new BABYLON.Vector3(1, 1, 1);
        steampunk.rotation = new BABYLON.Vector3(0, 90, 0);
        shadowGenerator.addShadowCaster(steampunk); //отбрасываемая тень
        steampunk.receiveShadows = true; //принимаемая тень
      }
    );



    engine.runRenderLoop(() => scene.render());


    
    // Обработчики событий
    drone.addEventListener('click', (event) => {
      const droneMesh = scene.getMeshByName("drone");
      if (droneMesh) {
          droneMesh.actionManager = new BABYLON.ActionManager(scene); // Создаем ActionManager для меша
          droneMesh.actionManager.registerAction(
              new BABYLON.ExecuteCodeAction(
                  BABYLON.ActionManager.OnPickTrigger, // Тип события: клик по мешу
                  () => {
                      alert("Вы жмакнули по drone"); // Действие при клике
                      droneMesh.dispose();
                  }
              )
          );
      } else {
          console.log("Меш с именем 'drone' не найден.");
      }
      /*
      if(activeElement){
        activeElement = null;
        event.target.innerText = '[drone] был активным';
        drone.scaling = new BABYLON.Vector3(0.5, 0.5, 0.5);
      }else{
        drone.dispose()
        //activeElement = drone;
        //event.target.innerText = '[drone] стал активным';
        //drone.scaling = new BABYLON.Vector3(0.7, 0.7, 0.7);
      }
      */
    });

    steampunk.addEventListener('click', (event) => {
      const steampunkMesh = scene.getMeshByName("steampunk");
      if (steampunkMesh) {
          steampunkMesh.actionManager = new BABYLON.ActionManager(scene); // Создаем ActionManager для меша
          steampunkMesh.actionManager.registerAction(
              new BABYLON.ExecuteCodeAction(
                  BABYLON.ActionManager.OnPickTrigger, // Тип события: клик по мешу
                  () => {
                      alert("Вы жмакнули по steampunk"); // Действие при клике
                      steampunkMesh.dispose();
                  }
              )
          );
      } else {
          console.log("Меш с именем 'steampunk' не найден.");
      }
      /*
      if(activeElement){
        activeElement = null;
        event.target.innerText = '[steampunk] был активным';
        //steampunk.scaling = new BABYLON.Vector3(0.5, 0.5, 0.5);
        steampunk.rotation = new BABYLON.Vector3(0, 90, 0);
      }else{
        steampunk.dispose()
        //activeElement = steampunk;
        //event.target.innerText = '[steampunk] стал активным';
        ////steampunk.scaling = new BABYLON.Vector3(0.7, 0.7, 0.7);
        //steampunk.rotation = new BABYLON.Vector3(0, -90, 0);
      }
      */
    });

    
    



  </script>
</body>