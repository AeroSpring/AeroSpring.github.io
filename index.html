<body> 
  <canvas></canvas>
  <style>
    body, canvas {
      margin: 0;
      width: 100vw;
      height: 100vh;
    }
  </style>

  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.js"></script>
  <script>

    // ИЗВЛЕЧЕНИЕ ТЕГОВ ИЗ РАЗМЕТКИ
    let canvas = window.document.querySelector('canvas');
   
    // СОЗДАНИЕ ДВИЖКА
    let engine = new BABYLON.Engine(canvas);
  
    // СОЗДАНИЕ СЦЕНЫ И ПРИСОЕДИНЕНИЕ ЕЁ К ДВИЖКУ
    let scene = new BABYLON.Scene(engine);
    scene.createDefaultEnvironment({
      createSkybox: false,
      createGround: false
    });
 
    // СОЗДАНИЕ СВЕТА
    let light = new BABYLON.PointLight('light', new BABYLON.Vector3(10, 10, -2), scene);
    light.intensity = 0.7;

    // ПОДКЛЮЧЕНИЕ WEBXR
    scene.createDefaultXRExperienceAsync({
      uiOptions: {
        sessionMode: 'immersive-ar', 
        referenceSpaceType: 'local-floor',
      }
    });



    // Создание куба
    let box = new BABYLON.Mesh.CreateBox('box', 0.25, scene);
    box.material = new BABYLON.StandardMaterial('material', scene);
    box.material.emissiveColor = new BABYLON.Color3(0, 0.58, 0.86);
    // Позиционирование
    box.position.x = -2;
    box.position.z = 0;
    // Степень непрозрачности
    box.hasVertexAlpha = true;
    //box.visibility = 0.7;
    //box.isPickable = true;
    if (!box.actionManager) {
      box.actionManager = new BABYLON.ActionManager(scene);
    }



    //ЗАГРУЗКА 3D-МОДЕЛИ
    let drone = BABYLON.SceneLoader.Append(
      'assets/drone/', 
      'drone.glb', 
      scene,
      (loadedScene) => {}
    );
    drone.scaling = new BABYLON.Vector3(0.5, 0.5, 0.5);
    drone.position = new BABYLON.Vector3(-1, 1, 4);
    shadowGenerator.addShadowCaster(drone); //отбрасываемая тень
    drone.receiveShadows = true; //принимаемая тень
    /*
    BABYLON.SceneLoader.ImportMesh(
      null, 
      'assets/drone/', 
      'drone.glb', 
      scene, 
      (meshArray) => {
        let droneMesh = meshArray[0];
        droneMesh.scaling = new BABYLON.Vector3(0.5, 0.5, 0.5);
        droneMesh.position = new BABYLON.Vector3(-1, 1, 4);
        shadowGenerator.addShadowCaster(droneMesh); //отбрасываемая тень
        droneMesh.receiveShadows = true; //принимаемая тень
      }
    );
    let drone = scene.getMeshByName("droneMesh");
    if (drone) {
      drone.actionManager = new BABYLON.ActionManager(scene);
    }
    */
    /*
    let drone = BABYLON.SceneLoader.Append(
      'assets/drone/', 
      'drone.glb', 
      scene,
      function (newScene) {
        // Callback function after the scene is appended
        // newScene is the appended scene object
        //let drone = newScene[0];
      }
    );
    drone.scaling = new BABYLON.Vector3(0.5, 0.5, 0.5);
    drone.position = new BABYLON.Vector3(-1, 1, 4);
    shadowGenerator.addShadowCaster(drone); //отбрасываемая тень
    drone.receiveShadows = true; //принимаемая тень
    //drone.actionManager = new BABYLON.ActionManager(scene);
    */

    let steampunk = BABYLON.SceneLoader.ImportMesh(
      null, 
      'assets/steampunk/', 
      'steampunk.glb', 
      scene, 
      (meshArray) => {
        let steampunkMesh = meshArray[0];
        steampunkMesh.scaling = new BABYLON.Vector3(0.15, 0.15, 0.15);
        steampunkMesh.position = new BABYLON.Vector3(1, 1, 1);
        steampunkMesh.rotation = new BABYLON.Vector3(0, 90, 0);
        shadowGenerator.addShadowCaster(steampunkMesh); //отбрасываемая тень
        steampunkMesh.receiveShadows = true; //принимаемая тень
      }
    );
    //steampunk = scene.getMeshByName("steampunkMesh");
    if (steampunk) {
      steampunk.actionManager = new BABYLON.ActionManager(scene);
    }



    engine.runRenderLoop(() => scene.render());


    
    // ОБРАБОТЧИКИ СОБЫТИЙ
    box.actionManager.registerAction(
      new BABYLON.ExecuteCodeAction(
        BABYLON.ActionManager.OnPickTrigger, 
        function(event) {
          box.scaling = new BABYLON.Vector3(2.0, 2.0, 2.0);
          box.dispose();
          // Вы можете использовать объект event для получения дополнительной информации
          console.log("Событие:", event);
        }
      )
    );
    
    drone.actionManager.registerAction(
      new BABYLON.ExecuteCodeAction(
        BABYLON.ActionManager.OnPickTrigger, 
        function(event) {
          //drone.scaling = new BABYLON.Vector3(0.5, 0.5, 0.5);
          drone.dispose();
          // Вы можете использовать объект event для получения дополнительной информации
          console.log("Событие:", event);
        }
      )
    );
    
    steampunk.actionManager.registerAction(
      new BABYLON.ExecuteCodeAction(
        BABYLON.ActionManager.OnPickTrigger, 
        function(event) {
          //steampunk.scaling = new BABYLON.Vector3(0.5, 0.5, 0.5);
          steampunk.dispose();
          // Вы можете использовать объект event для получения дополнительной информации
          console.log("Событие:", event);
        }
      )
    );
    
    

  </script>
</body>